<HTML>
<HEAD>
<TITLE>Extended Logging Filter</TITLE>
</HEAD>
<BODY>
<H1>Extended Logging Filter</H1>
The Extended Logging Filter (NewLog.dll) adds the HTTP-REFERER and the 
HTTP-USER-AGENT variables to the IIS log file.

<H2>Installation</H2>
<OL>
<LI>Copy NewLog.dll into your IIS install directory on your server.
<LI>Run REGEDT32.EXE
<LI>Go to the <TT>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\W3SCVC\Parameters</TT> key
<LI>Edit the &quot;Filter Dlls&quot; by double clicking on it.
<LI>Add &quot;,c:\path\to\NewLog.dll&quot; to the value (including the comma, without the quotes)
<LI>Save the value
<LI>Exit REGEDT32.EXE
<LI>Stop and restart the &quot;World Wide Web Publishing Service&quot;
</OL>

<H2>More information</H2>
The format of the Log File is changed by this filter.  Any log conversion utility 
that was written to use the original IIS log files (including convlog.exe that 
comes with IIS) will not work on these new log files.
<P>    
<DL>
<DT>Old log Format:
<DD>ClientIP, UserName, Date, Time, Service, ServerName, ServerIP, ProcessingTime, BytesReceived, BytesSent, ServiceStatus, Win32Status, Operation, TargetURL, Parameters

<DT>New log Format:
<DD>ClientIP, UserName, Date, Time, Service, ServerName, ServerIP, ProcessingTime, BytesReceived, BytesSent, ServiceStatus, Win32Status, Operation, TargetURL, UserAgent, Referer, Parameters
</DL>
<P>
As far as IIS is concerned, this filter puts the new information into the 
TargetURL field.  This will cause problems if IIS is configured to using 
ODBC logging and the length of TargetURL+UserAgent+Referer is longer than 255 chars.

<H2>Other Tools</H2>
The Convert.pl PERL script will convert IIS log files from the new format to the old 
format.  At the same time, it will replace any &quot;garbage&quot; characters that may 
be in the log file.
<P>
Convert.pl could easily be modified to produce statistics as it converts the log.  Open 
Convert.pl and look for the line &quot;###Statistics Here###&quot;.  This line indicates 
where you could add your own PERL code to get statistics on the new fields.  See the comments 
in the header of Convert.pl for more information on what Convert.pl does.


</BODY>
</HTML>

